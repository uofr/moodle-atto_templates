YUI.add("moodle-atto_template-button",function(e,t){var n="atto_template",r={TEMPLATENAME:"atto_template_name",PREVIEW:"atto_template_preview",INSERT:"atto_template_insert",CANCEL:"atto_template_cancel",DESCRIPTION:"atto_template_description",LIST:"templatelist",TYPE:"templatetype"},i={TEMPLATES:"."+r.TEMPLATENAME,INSERT:"."+r.INSERT,PREVIEW:"."+r.PREVIEW,CANCEL:"."+r.CANCEL,DESCRIPTION:"."+r.DESCRIPTION},s={FORM:'<form class="atto_form"><div class="form-group"><ul class="nav nav-tabs" id="cpath" name ="cpath" role="tablist"></ul></div><div class="card-block {{CSS.DESCRIPTION}}" id="{{elementid}}_{{CSS.DESCRIPTION}}"><div class="tab-content" id="tpath"><div class="tab-pane fade" id="preview"><label id="{{CSS.DESCRIPTION}}" class="d-block"> {{description}}</label><div class="card"><div class="card-block {{CSS.PREVIEW}}" id="{{elementid}}_{{CSS.PREVIEW}}"></div></div></div></div><div class="mdl-align"><button class="btn btn-primary {{CSS.INSERT}}">{{get_string "insert" component}}</button> <button class="btn btn-secondary {{CSS.CANCEL}}">{{get_string "cancel" component}}</button></div></div></form>'};e.namespace("M.atto_template").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_content:null,_templates:[],_categories:[],initializer:function(){this.addButton({icon:"icon",iconComponent:n,callback:this._displayDialogue}),this._templates=this.get("templates"),this._categories=this.get("categories")},_displayDialogue:function(){var e=this.getDialogue({headerContent:M.util.get_string("pluginname",n),focusAfterHide:!0,width:600}),t=this._getDialogueContent();e.set("bodyContent",t),e.show(),this._displayCategory()},_getDialogueContent:function(){var t=e.Handlebars.compile(s.FORM);return this._templates=this.get("templates"),this._categories=this.get("categories"),this._content=e.Node.create(t({elementid:this.get("host").get("elementid"),component:n,templates:this._templates,categories:this._categories,CSS:r})),this._content.one(i.INSERT).on("click",this._insertTemplate,this),this._content.one(i.CANCEL).on("click",this._cancel,this),this._content},_previewTemplate:function(t,n){var r,s,o=new XMLHttpRequest;o.onreadystatechange=function(){o.status==200&&o.readyState==4&&(template=o.responseText)},o.overrideMimeType&&o.overrideMimeType("text/plain"),o.open("GET",t,!1),o.send(null),s=e.one(i.PREVIEW),s.setHTML(template),this._getDescription(n),document.getElementById("preview-tab").click()},_getDescription:function(e){var t,n=this._templateFilter(e);t=document.getElementById(r.DESCRIPTION),t.innerHTML="Description: "+n.description},_insertTemplate:function(t){var n,r,s,o;s=this.get("host"),t.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();var u=e.one(i.PREVIEW);o=u.getHTML(),s.focus(),s.insertContentAtFocusPoint(o),this.markUpdated()},_cancel:function(e){e.preventDefault(),this.getDialogue().hide()},_templateFilter:function(e){len=Object.keys(this._templates).length;for(var t=0;t<len;t++)if(this._templates[t].templatekey==e)return this._templates[t];return this._templates},_displayCategory:function(){len=this._categories.length,csel=e.one("#cpath"),psel=e.one("#tpath");for(x=0;x<len;x++)tab=this._tabCreate(this._categories[x].name,this._categories[x].key),csel.appendChild(tab),pane=this._tabPaneCreate(this._categories[x].key),psel.appendChild(pane);tab=this._tabCreate("Preview","preview"),csel.appendChild(tab),this._setListeners()},_tabCreate:function(e,t){var n,r;return n=document.createElement("li"),n.setAttribute("class","nav-item template-nav"),r=document.createElement("a"),r.textContent=e,r.setAttribute("id",t+"-tab"),r.setAttribute("class","nav-link"),r.setAttribute("data-toggle","tab"),r.setAttribute("href","#"+t),n.appendChild(r),n},_tabPaneCreate:function(e){var t=document.createElement("div");return t.setAttribute("id",e),t.setAttribute("class","tab-pane fade"),t},_setListeners:function(){var t=document.getElementsByClassName("template-nav");for(var n=0;n<t.length;n++)e.one(t[n]).on("click",function(e){this._changeList(e._currentTarget.firstChild.getAttribute("id"))},this)},_changeList:function(e){if(e=="preview-tab")return;var t,n,r,i,s,o,u,a,f;t=this._templates,r=Object.keys(this._templates).length,i=e.substring(0,e.length-4),f=new RegExp,n=document.getElementById(i);if(n.hasChildNodes())return;s=document.createElement("ul");for(x=0;x<r;x++)t[x]&&t[x].templatekey.startsWith(i)&&(o=document.createElement("li"),lclass=t[x].title.slice(t[x].title.search(" ")),o.setAttribute("class",i+"-item"+lclass),o.setAttribute("data-path",t[x].src),o.setAttribute("id",t[x].templatekey),t[x].icon?(u=this._insertIcon(t[x].icon),o.appendChild(u)):(u=this._insertFontawesomeIcon(i+"-item"+lclass),o.appendChild(u)),a=document.createElement("p"),a.textContent=t[x].title,o.appendChild(a),s.appendChild(o));n.appendChild(s),this._setListListen(i+"-item")},_setListListen:function(t){var n=document.getElementsByClassName(t);for(var r=0;r<n.length;r++)e.one(n[r]).on("click",function(e){this._previewTemplate(e._currentTarget.getAttribute("data-path"),e._currentTarget.getAttribute("id"))},this)},_insertIcon:function(e){return icon=document.createElement("img"),icon.setAttribute("class","icon"),icon.setAttribute("src",e),icon},_insertFontawesomeIcon:function(e){return icon=document.createElement("i"),e.startsWith("alert")?icon.setAttribute("class","fa fa-exclamation-circle"):e.startsWith("button")?icon.setAttribute("class","fa fa-caret-square-o-down"):e.startsWith("callout")?icon.setAttribute("class","fa fa-square-o"):e.startsWith("pull")?icon.setAttribute("class","fa fa-quote-right"):e.startsWith("card")&&(e=="card-item Block"?icon.setAttribute("class","fa fa-address-card-o"):icon.setAttribute("class","fa fa-id-card-o")),icon}},{ATTRS:{templates:{value:{}},categories:{value:{}}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
