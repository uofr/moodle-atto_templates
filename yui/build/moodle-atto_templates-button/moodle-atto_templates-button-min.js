YUI.add("moodle-atto_templates-button",function(a,b){var c="atto_templates",d={TEMPLATENAME:"atto_templates_name",PREVIEW:"atto_templates_preview",INSERT:"atto_templates_insert",CANCEL:"atto_templates_cancel",DESCRIPTION:"atto_templates_description",LIST:"templatelist",TYPE:"templatetype"},e={TEMPLATES:"."+d.TEMPLATENAME,INSERT:"."+d.INSERT,PREVIEW:"."+d.PREVIEW,CANCEL:"."+d.CANCEL,DESCRIPTION:"."+d.DESCRIPTION},f={FORM:'<form class="atto_form"><div class="form-group"><ul class="nav nav-tabs" id="cpath" name ="cpath" role="tablist"></ul></div><div class="card-block {{CSS.DESCRIPTION}}" id="{{elementid}}_{{CSS.DESCRIPTION}}"><div class="tab-content" id="tpath"><div class="tab-pane fade" id="preview"><label id="{{CSS.DESCRIPTION}}" class="d-block"> {{description}}</label><div class="card"><div class="card-block {{CSS.PREVIEW}}" id="{{elementid}}_{{CSS.PREVIEW}}"></div></div></div></div><div class="mdl-align"><button class="btn btn-primary {{CSS.INSERT}}">{{get_string "insert" component}}</button> <button class="btn btn-secondary {{CSS.CANCEL}}">{{get_string "cancel" component}}</button></div></div></form>'};a.namespace("M.atto_templates").Button=a.Base.create("button",a.M.editor_atto.EditorPlugin,[],{_content:null,_templates:[],_categories:[],initializer:function(){this.addButton({icon:"icon",iconComponent:c,callback:this._displayDialogue}),this._templates=this.get("templates"),this._categories=this.get("categories")},_displayDialogue:function(){var a=this.getDialogue({headerContent:M.util.get_string("pluginname",c),focusAfterHide:!0,width:600}),b=this._getDialogueContent();a.set("bodyContent",b),a.show(),this._displayCategory()},_getDialogueContent:function(){var b=a.Handlebars.compile(f.FORM);return this._templates=this.get("templates"),this._categories=this.get("categories"),this._content=a.Node.create(b({elementid:this.get("host").get("elementid"),component:c,templates:this._templates,categories:this._categories,CSS:d})),this._content.one(e.INSERT).on("click",this._insertTemplate,this),this._content.one(e.CANCEL).on("click",this._cancel,this),this._content},_previewTemplate:function(b,c){var d,f=new XMLHttpRequest;f.onreadystatechange=function(){200==f.status&&4==f.readyState&&(template=f.responseText)},f.overrideMimeType&&f.overrideMimeType("text/plain"),f.open("GET",b,!1),f.send(null),d=a.one(e.PREVIEW),d.setHTML(template),this._getDescription(c),document.getElementById("preview-tab").click()},_getDescription:function(a){var b,c=this._templateFilter(a);b=document.getElementById(d.DESCRIPTION),b.innerHTML="Description: "+c.description},_insertTemplate:function(b){var c,d;c=this.get("host"),b.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();var f=a.one(e.PREVIEW);d=f.getHTML(),c.focus(),c.insertContentAtFocusPoint(d),this.markUpdated()},_cancel:function(a){a.preventDefault(),this.getDialogue().hide()},_templateFilter:function(a){len=Object.keys(this._templates).length;for(var b=0;b<len;b++)if(this._templates[b].templatekey==a)return this._templates[b];return this._templates},_displayCategory:function(){for(len=this._categories.length,csel=a.one("#cpath"),psel=a.one("#tpath"),x=0;x<len;x++)tab=this._tabCreate(this._categories[x].name,this._categories[x].key),csel.appendChild(tab),pane=this._tabPaneCreate(this._categories[x].key),psel.appendChild(pane);tab=this._tabCreate("Preview","preview"),csel.appendChild(tab),this._setListeners()},_tabCreate:function(a,b){var c,d;return c=document.createElement("li"),c.setAttribute("class","nav-item template-nav"),d=document.createElement("a"),d.textContent=a,d.setAttribute("id",b+"-tab"),d.setAttribute("class","nav-link"),d.setAttribute("data-toggle","tab"),d.setAttribute("href","#"+b),c.appendChild(d),c},_tabPaneCreate:function(a){var b=document.createElement("div");return b.setAttribute("id",a),b.setAttribute("class","tab-pane fade"),b},_setListeners:function(){for(var b=document.getElementsByClassName("template-nav"),c=0;c<b.length;c++)a.one(b[c]).on("click",function(a){this._changeList(a._currentTarget.firstChild.getAttribute("id"))},this)},_changeList:function(a){if("preview-tab"!=a){var b,c,d,e,f,g,h,i,j;if(b=this._templates,d=Object.keys(this._templates).length,e=a.substring(0,a.length-4),j=new RegExp,c=document.getElementById(e),!c.hasChildNodes()){for(f=document.createElement("ul"),x=0;x<d;x++)b[x]&&b[x].templatekey.startsWith(e)&&(g=document.createElement("li"),lclass=b[x].title.slice(b[x].title.search(" ")),g.setAttribute("class",e+"-item"+lclass),g.setAttribute("data-path",b[x].src),g.setAttribute("id",b[x].templatekey),b[x].icon?(h=this._insertIcon(b[x].icon),g.appendChild(h)):(h=this._insertFontawesomeIcon(e+"-item"+lclass),g.appendChild(h)),i=document.createElement("p"),i.textContent=b[x].title,g.appendChild(i),f.appendChild(g));c.appendChild(f),this._setListListen(e+"-item")}}},_setListListen:function(b){for(var c=document.getElementsByClassName(b),d=0;d<c.length;d++)a.one(c[d]).on("click",function(a){this._previewTemplate(a._currentTarget.getAttribute("data-path"),a._currentTarget.getAttribute("id"))},this)},_insertIcon:function(a){return icon=document.createElement("img"),icon.setAttribute("class","icon"),icon.setAttribute("src",a),icon},_insertFontawesomeIcon:function(a){return icon=document.createElement("i"),a.startsWith("alert")?icon.setAttribute("class","fa fa-exclamation-circle"):a.startsWith("button")?icon.setAttribute("class","fa fa-caret-square-o-down"):a.startsWith("callout")?icon.setAttribute("class","fa fa-square-o"):a.startsWith("pull")?icon.setAttribute("class","fa fa-quote-right"):a.startsWith("card")&&("card-item Block"==a?icon.setAttribute("class","fa fa-address-card-o"):icon.setAttribute("class","fa fa-id-card-o")),icon}},{ATTRS:{templates:{value:{}},categories:{value:{}}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});