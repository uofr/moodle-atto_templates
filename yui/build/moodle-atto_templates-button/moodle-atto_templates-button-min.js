YUI.add("moodle-atto_templates-button",function(a,b){var c="atto_templates",d={TEMPLATENAME:"atto_templates_name",PREVIEW:"atto_templates_preview",INSERT:"atto_templates_insert",CANCEL:"atto_templates_cancel",DESCRIPTION:"atto_templates_description",LIST:"templatelist",TYPE:"templatetype"},e={TEMPLATES:"."+d.TEMPLATENAME,INSERT:"."+d.INSERT,PREVIEW:"."+d.PREVIEW,CANCEL:"."+d.CANCEL,DESCRIPTION:"."+d.DESCRIPTION},f={FORM:'<form class="atto_form"><div class="form-group"><label for="{{elementid}}_{{CSS.TYPE}}">{{{get_string "selectacategory" component}}}</label><select class="{{CSS.TYPE}} form-control" id="{{CSS.TYPE}}" name="{{elementid}}_{{CSS.TYPE}}"><option value="">{{get_string "selectacategory" component}}</option>{{#each categories}}<option value="{{key}}">{{name}}</option>{{/each}}</select><label for="{{elementid}}_{{CSS.TEMPLATENAME}}">{{{get_string "selectatemplate" component}}}</label><select class="{{CSS.TEMPLATENAME}} form-control" id="{{CSS.LIST}}" name="{{elementid}}_{{CSS.TEMPLATENAME}}"><option value="">{{get_string "selectatemplate" component}}</option></select></div><div class="card-block {{CSS.DESCRIPTION}}" id="{{elementid}}_{{CSS.DESCRIPTION}}"><label for="{{elementid}}_{{CSS.PREVIEW}}" class="d-block">{{get_string "preview" component}}</label><label id="{{CSS.DESCRIPTION}}" class="d-block"> {{description}}</label><div class="card"><div class="card-block {{CSS.PREVIEW}}" id="{{elementid}}_{{CSS.PREVIEW}}"></div></div><div class="mdl-align"><button class="btn btn-primary {{CSS.INSERT}}">{{get_string "insert" component}}</button> <button class="btn btn-secondary {{CSS.CANCEL}}">{{get_string "cancel" component}}</button></div></form>'};a.namespace("M.atto_templates").Button=a.Base.create("button",a.M.editor_atto.EditorPlugin,[],{_content:null,_templates:[],_categories:[],initializer:function(){this.addButton({icon:"icon",iconComponent:c,callback:this._displayDialogue}),this._templates=this.get("templates"),this._categories=this.get("categories")},_displayDialogue:function(){var a=this.getDialogue({headerContent:M.util.get_string("pluginname",c),focusAfterHide:!0,width:600}),b=this._getDialogueContent();a.set("bodyContent",b),a.show()},_getDialogueContent:function(){var b=a.Handlebars.compile(f.FORM);return this._templates=this.get("templates"),this._categories=this.get("categories"),this._content=a.Node.create(b({elementid:this.get("host").get("elementid"),component:c,templates:this._templates,categories:this._categories,CSS:d})),this._content.one(e.TEMPLATES).on("change",this._previewTemplate,this),this._content.get(d.LIST).on("change",this._getDescription,this),this._content.get(d.TYPE).on("change",this._changeCategory,this),this._content.one(e.INSERT).on("click",this._insertTemplate,this),this._content.one(e.CANCEL).on("click",this._cancel,this),this._content},_previewTemplate:function(b){var c,d;c=document.getElementById("templatelist").value;var f=this._templateFilter(c);if(f.src){var g=new XMLHttpRequest;g.onreadystatechange=function(){200==g.status&&4==g.readyState&&(f=g.responseText)},g.overrideMimeType&&g.overrideMimeType("text/plain"),g.open("GET",f.src,!1),g.send(null)}d=a.one(e.PREVIEW),d.setHTML(f)},_getDescription:function(){var a,b;a=document.getElementById("templatelist").value;var c=this._templateFilter(a);b=document.getElementById(d.DESCRIPTION),b.innerHTML="Description: "+c.description},_insertTemplate:function(b){var c,d,f,g;if(f=this.get("host"),b.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),c=a.one(e.TEMPLATES),d=c.get("value"),g=this._templateFilter(d),"undefined"!=g.src){var h=a.one(e.PREVIEW);g.template=h.getHTML()}f.enableCssStyling(),f.insertContentAtFocusPoint(g.template),f.disableCssStyling(),this.markUpdated()},_cancel:function(a){a.preventDefault(),this.getDialogue().hide()},_templateFilter:function(a){len=Object.keys(this._templates).length;for(var b=0;b<len;b++)if(this._templates[b].templatekey==a)return this._templates[b];return this._templates},_changeCategory:function(b){value=document.getElementById(d.TYPE).value,len=Object.keys(this._templates).length,previewWindow=a.one(e.PREVIEW),previewWindow.setHTML(""),document.getElementById(d.DESCRIPTION).innerHTML="",ddl=this._content.get(d.LIST),dkey=document.getElementById("templatelist").options[0],ddl.empty(),ddl.append(dkey);for(var c=0;c<len-1;c++)this._templates[c].templatekey.startsWith(value)&&ddl.append("<option value='"+this._templates[c].templatekey+"'>"+this._templates[c].title+"</option>")}},{ATTRS:{templates:{value:{}},categories:{value:{}}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});